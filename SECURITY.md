# Политика безопасности и техническая реализация

## Уведомление об уязвимостях

При обнаружении проблем безопасности, пожалуйста, не используйте публичные системы отслеживания ошибок. Направляйте отчеты напрямую: [@ingeniare](https://github.com/ingeniare)

## Архитектура безопасности

Данная реализация базируется на следующих принципах и технических мерах:

### Разграничение прав доступа
Служба MTProxy исполняется от имени выделенной системной учетной записи `mtproxy`, для которой деактивирована возможность входа в систему (no login shell) и отсутствует домашняя директория. Это минимизирует риски при потенциальной компрометации сервиса.

### Изоляция учетных данных
Операционные секреты хранятся в защищенном файле `/etc/mtproxy/secret` с правами доступа `0600` (чтение и запись только для владельца). Это предотвращает утечку ключей через средства диагностики systemd или файлы конфигурации юнитов.

### Обфускация протокола (Fake TLS)
Для противодействия системам глубокого анализа трафика (DPI) и эвристическим алгоритмам идентификации реализована поддержка транспорта Fake TLS. Использование секретов формата `ee` и параметра `--domain` позволяет инкапсулировать трафик, имитируя стандартное TLS-рукопожатие с доверенными доменами.

### Автоматизированная защита (Rate-Limiting)
Сценарий установки настраивает правила `iptables` с использованием модуля `hashlimit`. Это обеспечивает ограничение частоты новых TCP-сессий для каждого исходного IP-адреса, снижая видимость сервера для автоматизированных систем сканирования и цензуры (ТСПУ).

### Контроль целостности конфигурации
Процедура автоматического обновления настроек Telegram включает этап валидации. Загружаемые ресурсы проверяются на соответствие минимальному размеру и корректность структуры перед применением. В случае ошибки обновления система сохраняет последнюю стабильную конфигурацию.

### Сетевая устойчивость
Определение внешнего IP-адреса осуществляется через каскад из 8 независимых источников. Сохранность сетевого периметра после перезагрузки узла обеспечивается интеграцией с `netfilter-persistent`.

## Рекомендации по эксплуатации

1.  **Аутентификация**: Используйте доступ к хосту по SSH-ключам и отключите вход по паролю.
2.  **Мониторинг**: Регулярно проверяйте журналы службы через `journalctl -u MTProxy` для выявления аномальных паттернов подключений.
3.  **Защита хоста**: Установите `fail2ban` для защиты интерфейса управления SSH от перебора паролей.
4.  **Обновления**: Своевременно применяйте патчи безопасности для основной операционной системы.
5.  **Выбор домена**: В продуктивной среде рекомендуется использовать собственные или специфические домены для эмуляции Fake TLS.
6.  **Доступ к статистике**: Веб-интерфейс статистики доступен только через loopback-интерфейс (`localhost`). Не открывайте этот порт для внешних сетей.
